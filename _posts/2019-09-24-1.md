---
layout: post
title: Docker Memo
category: etc
tags:
  - content
  - Docker
  - centos
excerpt_separator: <!--more-->
---
도커는 이것이다.

<!--more-->

## 1. centos7 으로 진행

AWS 새 instance 생성

```bash
ssh -i "key.pem" centos@ip.ip.ip.ip
```

identity key(`key.pem`)으로 접속한다.  
접속이 안된다면 보안 그룹을 다시 설정하거나

```bash
yum -y update
```

yes option을 자동으로 해주고 update 시킨다.

---

## 2. Docker install

```bash
yum -y install docker docker-registry
```

이 두 가지를 모두 다운 받아야 한다.

| docker-registry                                                                                                    |
| ------------------------------------------------------------------------------------------------------------------ |
| docker image를 공유하기 위한 server application. docker image build를 위한 dockerfile을 github 저장소에서 제공 중. |

```bash
systemctl start docker
```

도커를 실행 시킨다.

---

## 3. Docker use

```bash
sudo su
```

Docker는 관리자 권한이 필요하다.  
항상 관리자 권한을 주는 설정이 있다고 한다.
근데 난 모름ㅅㄱ.

```bash
docker search [ option ] [ 검색어 ]
```

검색하면 official되어있는 것을 주로 쓰게 될 것.

| option            |                        |
| ----------------- | ---------------------- |
| --automated=false | autobuild만 표시          |
| --no-trunc=false  | 모든 결과 다 표시             |
| -s=n              | star 수가 n개 이상인 결과 다 표시 |

```bash
docker pull [ option ] [ image name ][:tag name]
```

search를 통해 검색한 image를 pull을 하면 다운 받을 수 있다.

```bash
docker images
```

도커가 다운 받은 이미지의 목록을 볼 수 있다.

```bash
docker ps -a 

docker ps
```

container의 목록을 볼 수 있다.  
-a 옵션은 현재 run 되고있는 것만 보여준다.

```bash
docker run 
  -d              # demon
  -p              # ? 까먹음 나중에기록
  8282:8080       # container의 default(8080)을 8282로 연결
  --name test01   # container name
  tomcat          # container image

```
container를 실행시키는 명령
| docker |                 |
| ------ | --------------- |
| run    | create + start  |
| create | container 단순 생성 |
| start  | container 시작    |
  
내 ip로 접근이 안된다면 firewall 설정하거나 (AWS)보안 그룹 설정.  

```bash
docker exec
  -it               # terminal shell에서 확인하게따
  test01            # container id
  /bin/bash
```

Docker container 내부 접근 명령.  

```bash
docker cp 
  ./war2.war      # 현재위치의 file name
  d9              # container name
  :/usr/local/tomcat/webapps/   # container path

docker cp ./war2.war (test01:컨테이너anme):/usr/local/tomcat/webapps/
```

centos7에 mobaXterm으로 파일 공유 후 container로 복사하기

```bash
docker rm [container id]    # remove container
docker rmi [image id]       # remove images
```

삭제 명령.


---

## 3. Docker image create & upload

[Docker homepage](https://hub.docker.com/)에서 회원가입을 한다.


```bash
docker login
```

여기서 login하면 된다.

```bash
docker commit 
  -a "ryeom<ryeom@example.com>"     # 생성자 정보
  -m "test01"                       # message
  09                                # container id
  sa2who2                           # docker hub id
  /wartest:0.0.1             # container name / tag
  
docker commit -a "ryeom<ryeom@example.com>" -m "image test 입니다" 09 ryeom/wartest01:0.0.1
```

이렇게 하면 image로 만들어 진다.

```bash
docker push 
  ryeom/      # 제작자 아이디
  wartest01   # image name
  :0.0.1      # tag

docker push ryeom/wartest01:0.0.1
```
