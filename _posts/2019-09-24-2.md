---
layout: post
title: Jenkins local에서 실행하기
category: etc
tags:
  - content
  - Jenkins
  - CI/CD
---

### CI(Continuous Intergration : 지속적 통합)

분석/ 설계 → code 작성 → biuld → test → release → deploy

<u>software 개발 project lifecycle</u>는 환경설정과 더불어 작업하는 양이 많고 복잡하다. 이러한 software 통합작업 완성에 가까워지기까지 반드시 필요한 작업이다.

CI는 개발 팀원들이 작성한 code를 최대한 자주 통합하는 개발 실천법이다.

- biuld와 test가 자동화되어 code작성에 더욱 집중 가능.
- 자동화를 통해 수시로 통합가능(빠른 문제해결).
- biuld와 test를 개인 환경과 독립적으로 구성 가능.
- biuld결과를 WAS Server나 기타 환경에 대해 Deploy하는 업무를 자동화 함으로써 process를 간소화 할 수 있다.
- 협업해서 수정한 내용을 자동으로 biuld하여 통합 test 진행가능.
- 현재 프로젝트의 코딩 표준과 모듈별 의존성 등의 보고서를 빌드과정에서 자동화 함으로써 개선여부 검토가능

개별 biuld Server에 설치되어 biuld를 진행하는 프로그램을 보통 biuld를 Agent라고 한다. biuld는 시스템 자원을 많이 소비하는 부하가 큰작업으로 분산 환경으로 여러개의 biuld Server를 동시에 운영하는 경우가 많다.

보통 CI system을 구축하게 되면 CI Server는 repository에 commit된 소스 코드를 주기적으로 폴링하여 compile, unit test, code inspection(검사) 등 과정을 수행하여 결함을 지속적으로 검증한다.

## Local 환경에서 jenkins 실행하기 & 환경 설정

[Jenkins Site](https://jenkins.io/) 접속하여 LTS Release를 다운받는다.
다운 받은 Jenkins의 War File을 Web Server로 구동할 예정이다.
이는 Tomcat Home위치에 Webapps에 **Jenkins.war**를 넣는다.
Tomcat start하면 Jenkins dir이 생긴다.
`http://localhost:8080/jenkins` 로 접속하면 key를 입력하라는 문구가 나온다.
뭐 예를들면 `C:\users\.jenkins\secrets\initialAdminPassword ...`뭐 이런식
해당 경로로 가서 복사 후 붙여넣기를 실행한다.
사용자를 만들라고하면 만들고 일단 접속한다.
jenkins 배포를 하려면 tomcat manager를 접근하여 `tomcat-user.xml`을 수정한다.
(사용자권한으로열기)

```xml
<role rolename="manager-gui"/>
<role rolename="manager-script"/>
<role rolename="manager-jmx"/>
<role rolename="manager-status"/>
<role rolename="admin-gui"/>
<role rolename="admin-script"/>
<user username="admin" password="admin" roles="manager-gui,manager-script,manager-jmx,manager-status,admin-gui,admin-script"/>
```

### maven 설치하기

[maven site](https://maven.apache.org/download.cgi#)에서 최신 버전으로 zip을 다운로드 한다.
`D:\dev\apache-maven-3.6.2` 대강 적절한 위치에 압축 파일을 풀어준다.

##### maven 환경 변수 설정

- 제어판 > 시스템 > 고급시스템설정 > 환경변수
  - 새로만들기(새 시스템 변수)
  - MAVEN_HOME
  - `D:\dev\apache-maven-3.6.2` (압축해제한 경로)
  - 시스템 변수 목록에서 path를 찾아 편집
  - 변수 값에 추가로 `%MAVEN_HOME%\bin`

Jenkins 관리 > Global Tool Configration  
jdk, git, maven, gradle 등의 경로를 알려준다.

| option   |                                                                                                                |
| -------- | -------------------------------------------------------------------------------------------------------------- |
| open jdk | [openjdk url](https://download.java.net/java/GA/jdk11/13/GPL/openjdk-11.0.1_linux-x64_bin.tar.gz)              |
| git      | [C:\Program Files\Git\bin\git.exe](https://mirrors.edge.kernel.org/pub/software/scm/git/)                      |
| maven    | [D:\dev\apache-maven-3.6.2](http://apache.tt.co.kr/maven/maven-3/3.6.2/binaries/apache-maven-3.6.2-bin.tar.gz) |

### Github Server 설정

- Github Access Token
- login > developer settings
- Personal access tokens > Generate new token
- Tokin description 작성
- 권한 scope 지정 ☑ repo ☑ admin:repo_hook
- <u>token 복사 후 저장</u>(※영영 못봄 주의)
- jenkins 관리 > 시스템 설정
- GitHub Servers
  - name : github_server
  - API_URL : https://api.github.com
  - 그밑에 Credentials : Add(Key 생성)
    - kind : secret text
    - scope : github에서 생성한 access Token
    - id : credentials 구분 이름

## Project 생성 & 환경 설정

### 1. General

github project ✓

- projet url : https://github.com/.../.../

### 2. 소스 코드 관리

git ✓

- Repositories
  - Repository URL : 위와 동일
  - Credentials : Add(Key 생성)
    - 자신의 git E-mail로 login
    - test connection

### 3. 빌드 유발

GitHub hook trigger for GITScm polling ✓

### 4. 빌드 환경

설정없음

### 5. Build

Invoke top-level Maven targets ✓

| option        |               |
| ------------- | ------------- |
| Maven Version | maven         |
| Goals         | clean package |
| 고급          |               |
| POM           | pom.xml       |

### 6. 빌드 후 조치

설정없음

## GitHub Web Hook 설정

내가 관리하는 리포지토리에 어떠한 이벤트가 발생했을 경우 트리거를 설정해두고 싶다면 jenkins job을 활용.

### jenkins Security 설정

CSRF Protection 설정 체크 해제 □
외부에서 job에대한 트리거링 가능

github에서 webhook에 의해 jenkins job을 실행.

@ Param `payload`  
@ method `POST`

Jenkins project로 간다
General > □ 이 빌드는 매개변수가 있습니다.

- String Parameter
- 매개변수명 : payload

### Github Webhook 설정

Repository > Settings > Hooks > `add WebHook`

- payload url
  - [jenkins url]/jenkins/job/{job name}/buildWithParameters
  - application/x-www-form-urlencoeded
  - Let me select individual events.
    - pushes

jdk
jdk 설정
Global Tool Configuration 페이지
JDK > JDK installations… 클릭
Add JDK 클릭
Name: java8
JAVA_HOME: /usr/local/openjdk-8 입력 (도커 이미지에 포함되어 있다)
Save 클릭

build > goals > clean install -DskipTests=true
