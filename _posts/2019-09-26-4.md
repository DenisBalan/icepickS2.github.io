---
layout: post
title: spring boot start
category: spring
tags:
  - content
  - spring
excerpt_separator: <!--more-->
---

#### spring boot

제품(production grade or 운영)수준의spring 기반의 독립적인 Application을 만들 때 빠르고 쉽게 만들 수 있도록 도와준다.

 <!--more-->

### Opinionated view

- spring boot가 가진 convention(협약 : 널리쓰이는 설정을 개발자가 안하도록 미리 해줌)

- XML configuration, code generation을 더이상 하지않음.

- dependency management
  - 특별히 원하는 version이 있다면 쓰면 됨.
- 더이상 우리가 버전관리 하지 않아도 된다.

## 자동 설정

### @SpringBootApplication

@SpringBootConfiguration
@ComponentScan(Bean 1단계 등록)
@EnableAutoConfiguration(Bean 2단계 등록)

| ※ Spring Boot는 Bean을 <u>2번</u> 등록 |                    |
| -------------------------------------- | ------------------ |
| ~Spring-Boot-AutoConfigure             | 자동설정           |
| ~Spring-Boot-Starter                   | 필요한 의존성 정의 |

#### Spring Boot 자동 설정

1. 의존성 추가

```XML
   <dependencies>
  <dependency>
      <groupId>org.springframework.boot</groupId>
      <artifactId>spring-boot-autoconfigure</artifactId>
  </dependency>
  <dependency>
      <groupId>org.springframework.boot</groupId>
      <artifactId>spring-boot-autoconfigure-processor</artifactId>
      <optional>true</optional>
  </dependency>
</dependencies>

<dependencyManagement>
  <dependencies>
      <dependency>
          <groupId>org.springframework.boot</groupId>
          <artifactId>spring-boot-dependencies</artifactId>
          <version>2.0.3.RELEASE</version>
          <type>pom</type>
          <scope>import</scope>
      </dependency>
  </dependencies>
</dependencyManagement>
```

2. @Configuration 작성

3. `src/main/resource/META-INF` spring.factories file 만들기

4. 자동설정 파일 추가

```properties
org.springframework.boot.autoconfigure.EnableAutoConfiguration=\
FQCN,\
FQCN
```

5. mvn install

`@ConditionalOnMissingBean` 덮어쓰기 방지(기본값 비우선)
`@ConfigurationProperties("holoman")`
`@EnableConfigurationProperties(HolomanProperties)`
프로퍼티 키값 자동완성

### 내장 Web Server

spring boot는 Web Server가 아니다.
걍 끝낼 수도 있다.
내장 servlet Container를 잘 쓸 수 있게 도와줌
java code로 Tomcat을 만들 수 있다.

1. Tomcat객체 생성
2. port설정
3. Tomcat에 Context 추가
4. Servlet 만들기
5. Tomcat에 Servlet 추가
6. Context에 Servlet Mapping
7. Tomcat run & await

이 모든 과정을 보다 상세하고 유연하게 실행해 주는 것이 스프링 부트의 자동 설정

ServletWebServerFactoryAutoConfiguration

- servlet Web Server 생성.
- TomcatServletWebServerFactoryCustomizer

DispatcherSevletAutoConfiguration

- Servlet 만들고 등록.

```java
Tomcat tomcat = new Tomcat();
tomcat.setPort(8080);
Context context = tomcat.addContext("/","/");
HttpServlet servlet = new HttpServlet() {
    @Override
	protected void doGet(HttpServletRequest req,HttpServletResponse res) throws IOException {
		PrintWriter writer = res.getWriter();
		writer.println("<html><head><title>");
		writer.println("hi~!");
		writer.println("</title></head>");
		writer.println("<body><h1>hello tomcat</h2></body>");
		writer.println("</html>");
	}
};

String servletName = "helloServlet";
tomcat.addServlet("/", servletName, servlet);
context.addServletMappingDecoded("/hello",servletName);

tomcat.start();
tomcat.getServer().await();
```
